# Yuho v5 PRD - Generated 2026-02-01
# Priority: (A) MVP/critical path, (B) Important, (C) Can parallelize

# ============================================================================
# AST: Internal representation and semantic analysis
# ============================================================================


# ============================================================================
# TRANSPILATION: Multi-target code generation
# ============================================================================


# ============================================================================
# CLI: Command-line interface with rich error messages
# ============================================================================


# ============================================================================
# LSP: Full Language Server Protocol implementation
# ============================================================================


# ============================================================================
# MCP: Model Context Protocol server exposing all functionality
# ============================================================================


# ============================================================================
# LLM: Local-first with Ollama/HuggingFace, cloud fallback
# ============================================================================


# ============================================================================
# CONFIG: User configuration system
# ============================================================================

(B) Implement [transpile] config: default_target, latex_compiler, output_dir +config
(B) Implement [lsp] config: diagnostic_severity_levels, completion_trigger_chars +config
(B) Implement [mcp] config: host, port, allowed_origins, auth_token +config
(B) Implement `yuho config show` command to display current configuration +config
(B) Implement `yuho config set <key> <value>` command for runtime config updates +config
(C) Implement config file validation with helpful error messages for invalid values +config

# ============================================================================
# TEST: Property-based testing with Hypothesis
# ============================================================================

(B) Implement exhaustiveness invariant: generated match exprs pass exhaustiveness check +test
(B) Implement reachability invariant: no generated match arms are unreachable +test
(B) Implement JSON round-trip invariant: from_json(to_json(ast)) == ast +test
(B) Implement transpilation determinism: transpile(ast) == transpile(ast) (no randomness) +test
(B) Implement cross-transpiler consistency: json_ast parsed from JSON equals original AST +test
(C) Implement fuzzing harness for parser with arbitrary byte sequences +test
(C) Implement differential testing against v4 Lark parser for compatible inputs +test

# ============================================================================
# VERIFY: Formal verification with Alloy and Z3
# ============================================================================

(B) Implement Alloy model generator from statute AST for bounded model checking +verify
(B) Implement Alloy analyzer subprocess invocation with timeout +verify
(B) Implement Alloy counterexample parser to surface violations as diagnostics +verify
(B) Define Alloy assertion: no_contradictory_elements (statute elements don't contradict) +verify
(B) Define Alloy assertion: penalty_ordering (more serious crimes have higher penalties) +verify
(C) Implement Z3 solver integration via z3-solver Python bindings +verify
(C) Implement Z3 constraint generation from match-case conditions +verify
(C) Implement Z3 satisfiability check for "is this pattern reachable?" queries +verify
(C) Implement Z3 model extraction to generate concrete test cases +verify

# ============================================================================
# LIBRARY: User-contributed statute repository
# ============================================================================

(B) Define contribution format: directory with statute.yh, test_statute.yh, metadata.toml +library
(B) Define metadata.toml schema: section_number, title, jurisdiction, contributor, version +library
(B) Implement contribution validator: parse .yh, run tests, check metadata completeness +library
(B) Implement .yhpkg archive format: gzipped tarball with signature file +library
(B) Implement library index: JSON file mapping section numbers to package metadata +library
(B) Implement library search by section number, title keyword, jurisdiction +library
(B) Implement library install command: download .yhpkg, verify signature, extract to ~/.yuho/library +library
(C) Implement library publish command: upload to configured registry URL +library
(C) Implement library update command: check for newer versions of installed packages +library

# ============================================================================
# STATUTES: Implement 10+ Penal Code sections for language breadth
# ============================================================================

(B) Implement S463 Forgery: demonstrate document-related offense +statutes
(B) Implement S499 Defamation: demonstrate speech-based offense with exceptions +statutes
(B) Implement S503 Criminal Breach of Trust: demonstrate fiduciary offense +statutes
(C) Write comprehensive test suite for each implemented statute using Hypothesis +statutes
(C) Create example illustrations for each statute showing typical fact patterns +statutes

# ============================================================================
# NEOVIM: LSP extension with tree-sitter highlighting
# ============================================================================

(B) Create nvim-yuho plugin structure: lua/yuho/init.lua, queries/, ftdetect/ +neovim
(B) Implement filetype detection for .yh files in ftdetect/yuho.vim +neovim
(B) Bundle tree-sitter-yuho parser for nvim-treesitter integration +neovim
(B) Write tree-sitter highlight queries in queries/yuho/highlights.scm +neovim
(B) Write tree-sitter indent queries in queries/yuho/indents.scm +neovim
(B) Write tree-sitter fold queries in queries/yuho/folds.scm +neovim
(B) Implement LSP client configuration connecting to `yuho lsp` +neovim
(B) Implement on_attach function enabling completion, diagnostics, formatting +neovim
(C) Add which-key integration for Yuho-specific keybindings +neovim
(C) Add telescope.nvim integration for statute symbol search +neovim
(C) Add lualine.nvim integration showing current statute section in statusline +neovim

# ============================================================================
# ROADMAP: v6 items (visual editor and beyond)
# ============================================================================

(D) [v6] Design Scratch-like block palette for Yuho constructs +roadmap
(D) [v6] Implement drag-and-drop block editor using Blockly or custom React components +roadmap
(D) [v6] Implement bidirectional sync between block editor and .yh source +roadmap
(D) [v6] Implement localhost-only web server serving visual editor UI +roadmap
(D) [v6] Implement block-to-AST and AST-to-block converters +roadmap
(D) [v6] Design guided statute builder wizard for non-programmers +roadmap
(D) [v6] Implement collaborative editing via CRDT synchronization +roadmap

# ============================================================================
# DOCS: Remaining once everything else is done
# ============================================================================

(C) Read through every document within ./doc/ and rewrite/update them while keeping to the same writing style for the current v5 support
(C) If a document within ./doc/ clearly refers to a previous version of Yuho v0-v4 or sandbox, update me
(C) Update the following sections within README.md of Output formats of Rationale section and Nerd stuff (if required)